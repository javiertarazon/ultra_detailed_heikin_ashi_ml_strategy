# ğŸ—ºï¸ Diagrama Visual del Sistema BotCopilot SAR v3.0

## ARQUITECTURA GENERAL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USUARIO / CLI                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          main.py                                 â”‚
â”‚                   (PUNTO DE ENTRADA ÃšNICO)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ --train-ml  â”‚  â”‚ --optimize   â”‚  â”‚ --backtest   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                â”‚                  â”‚                    â”‚
â”‚         â”‚                â”‚                  â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ --live-ccxt â”‚  â”‚ --live-mt5   â”‚  â”‚ --data-audit â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAPA DE CONFIGURACIÃ“N                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              config/config.yaml                            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â€¢ SÃ­mbolos: [BNB/USDT]                                   â”‚ â”‚
â”‚  â”‚  â€¢ Timeframe: 4h                                          â”‚ â”‚
â”‚  â”‚  â€¢ Estrategia: UltraDetailedHeikinAshiML                  â”‚ â”‚
â”‚  â”‚  â€¢ ML Training: Random Forest enabled                     â”‚ â”‚
â”‚  â”‚  â€¢ PerÃ­odos: 2022-2024                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAPA DE DATOS                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SQLite DB       â”‚  â”‚  CSV Files       â”‚  â”‚  Downloader   â”‚ â”‚
â”‚  â”‚  (Prioridad #1)  â”‚â—„â”€â”¤  (Fallback)      â”‚â—„â”€â”¤  (Auto)       â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚               â”‚ â”‚
â”‚  â”‚  data/data.db    â”‚  â”‚  data/csv/       â”‚  â”‚  CCXT + MT5   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  FunciÃ³n Centralizada: ensure_data_availability()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAPA DE PROCESAMIENTO                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           TechnicalIndicators (Centralizado)              â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â€¢ Heikin Ashi    â€¢ RSI          â€¢ MACD                  â”‚  â”‚
â”‚  â”‚  â€¢ EMA            â€¢ Stochastic   â€¢ Volume                â”‚  â”‚
â”‚  â”‚  â€¢ ATR            â€¢ ADX          â€¢ Bollinger             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                 â”‚
            â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ML TRAINING     â”‚  â”‚   BACKTESTING     â”‚
â”‚                   â”‚  â”‚                   â”‚
â”‚  MLTrainer        â”‚  â”‚  Orchestrator     â”‚
â”‚  â”œâ”€ Download      â”‚  â”‚  â”œâ”€ Load Data     â”‚
â”‚  â”œâ”€ Features      â”‚  â”‚  â”œâ”€ Load Strategy â”‚
â”‚  â”œâ”€ Labels        â”‚  â”‚  â”œâ”€ Execute       â”‚
â”‚  â”œâ”€ TimeSeriesSplitâ”‚  â”‚  â”œâ”€ Calculate    â”‚
â”‚  â”œâ”€ Train RF      â”‚  â”‚  â”œâ”€ Metrics       â”‚
â”‚  â””â”€ Save Model    â”‚  â”‚  â””â”€ Save Results  â”‚
â”‚                   â”‚  â”‚                   â”‚
â”‚  models/          â”‚  â”‚  data/dashboard_  â”‚
â”‚  BNB_USDT/        â”‚  â”‚  results/         â”‚
â”‚  RandomForest.pkl â”‚  â”‚  *_results.json   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â”‚                       â”‚
         â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPTIMIZATION     â”‚  â”‚   DASHBOARD       â”‚
â”‚                   â”‚  â”‚                   â”‚
â”‚  OptimizationPipe â”‚  â”‚  Streamlit App    â”‚
â”‚  â”œâ”€ Train ML      â”‚  â”‚  â”œâ”€ Load Results  â”‚
â”‚  â”œâ”€ Optuna Study  â”‚  â”‚  â”œâ”€ Visualize     â”‚
â”‚  â”œâ”€ N Trials      â”‚  â”‚  â”œâ”€ Metrics       â”‚
â”‚  â”œâ”€ Best Params   â”‚  â”‚  â”œâ”€ Equity Curve  â”‚
â”‚  â””â”€ Backtest      â”‚  â”‚  â””â”€ Trade List    â”‚
â”‚                   â”‚  â”‚                   â”‚
â”‚  data/optimizationâ”‚  â”‚  Port: 8520       â”‚
â”‚  _results/        â”‚  â”‚  Auto-launch      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## FLUJO DE DATOS DETALLADO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FLUJO COMPLETO DE DATOS                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  USER INPUT
      â”‚
      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ main.py â”‚
  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€[1]â”€â†’ validate_system()
       â”‚            â””â”€â†’ Verificar config + estrategias + deps
       â”‚
       â”œâ”€â”€â”€[2]â”€â†’ verify_data_availability()
       â”‚            â”‚
       â”‚            â”œâ”€â†’ [A] Check SQLite
       â”‚            â”‚      â”œâ”€ EXISTS? â†’ Return data âœ…
       â”‚            â”‚      â””â”€ NOT EXISTS? â†’ Continue to [B]
       â”‚            â”‚
       â”‚            â”œâ”€â†’ [B] Check CSV
       â”‚            â”‚      â”œâ”€ EXISTS? â†’ Save to SQLite â†’ Return data âœ…
       â”‚            â”‚      â””â”€ NOT EXISTS? â†’ Continue to [C]
       â”‚            â”‚
       â”‚            â””â”€â†’ [C] Download Automatically
       â”‚                   â”œâ”€ CCXT (Binance/Bybit)
       â”‚                   â”œâ”€ MT5 (Forex/Stocks)
       â”‚                   â”œâ”€ Save to SQLite
       â”‚                   â”œâ”€ Save to CSV
       â”‚                   â””â”€ Return data âœ…
       â”‚
       â”œâ”€â”€â”€[3]â”€â†’ MODE SELECTION
       â”‚         â”‚
       â”‚         â”œâ”€â†’ [--train-ml]
       â”‚         â”‚      â”‚
       â”‚         â”‚      â””â”€â†’ MLTrainer
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ download_data()
       â”‚         â”‚             â”‚      â””â”€â†’ ensure_data_availability()
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ prepare_features()
       â”‚         â”‚             â”‚      â””â”€â†’ TechnicalIndicators.calculate_all()
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ create_labels()
       â”‚         â”‚             â”‚      â””â”€â†’ future_returns based
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ TimeSeriesSplit(n_splits=5)
       â”‚         â”‚             â”‚      â”œâ”€ Fold 1: Train[0:20%] â†’ Val[20:40%]
       â”‚         â”‚             â”‚      â”œâ”€ Fold 2: Train[0:40%] â†’ Val[40:60%]
       â”‚         â”‚             â”‚      â”œâ”€ Fold 3: Train[0:60%] â†’ Val[60:80%]
       â”‚         â”‚             â”‚      â”œâ”€ Fold 4: Train[0:80%] â†’ Val[80:100%]
       â”‚         â”‚             â”‚      â””â”€ NO LOOK-AHEAD BIAS âœ…
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ train_random_forest()
       â”‚         â”‚             â”‚      â”œâ”€ n_estimators: 100
       â”‚         â”‚             â”‚      â”œâ”€ max_depth: 10
       â”‚         â”‚             â”‚      â””â”€ Cross-validation
       â”‚         â”‚             â”‚
       â”‚         â”‚             â””â”€â†’ save_model()
       â”‚         â”‚                    â”œâ”€ models/BNB_USDT/RandomForest.joblib
       â”‚         â”‚                    â”œâ”€ models/BNB_USDT/RandomForest_scaler.joblib
       â”‚         â”‚                    â””â”€ models/BNB_USDT/RandomForest_metadata.json
       â”‚         â”‚
       â”‚         â”œâ”€â†’ [--optimize]
       â”‚         â”‚      â”‚
       â”‚         â”‚      â””â”€â†’ OptimizationPipeline
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ Phase 1: Train ML
       â”‚         â”‚             â”‚      â””â”€â†’ MLTrainer.run()
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ Phase 2: Optimize Parameters
       â”‚         â”‚             â”‚      â”œâ”€â†’ Optuna Study
       â”‚         â”‚             â”‚      â”œâ”€â†’ N Trials (100)
       â”‚         â”‚             â”‚      â””â”€â†’ Multi-objective:
       â”‚         â”‚             â”‚             â€¢ Max: PnL, Win Rate, Profit Factor
       â”‚         â”‚             â”‚             â€¢ Min: Max Drawdown
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ Phase 3: Backtest with Best Params
       â”‚         â”‚             â”‚      â””â”€â†’ AdvancedBacktester
       â”‚         â”‚             â”‚
       â”‚         â”‚             â””â”€â†’ Phase 4: Save Results
       â”‚         â”‚                    â””â”€â†’ data/optimization_results/
       â”‚         â”‚
       â”‚         â”œâ”€â†’ [--backtest-only]
       â”‚         â”‚      â”‚
       â”‚         â”‚      â””â”€â†’ BacktestingOrchestrator
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ load_strategies_from_config()
       â”‚         â”‚             â”‚      â””â”€â†’ UltraDetailedHeikinAshiML
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ ensure_data_availability()
       â”‚         â”‚             â”‚      â””â”€â†’ SQLite â†’ CSV â†’ Download
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ FOR EACH SYMBOL:
       â”‚         â”‚             â”‚      â”‚
       â”‚         â”‚             â”‚      â””â”€â†’ FOR EACH STRATEGY:
       â”‚         â”‚             â”‚             â”‚
       â”‚         â”‚             â”‚             â”œâ”€â†’ strategy.run(data, symbol)
       â”‚         â”‚             â”‚             â”‚      â”‚
       â”‚         â”‚             â”‚             â”‚      â”œâ”€â†’ calculate_heikin_ashi()
       â”‚         â”‚             â”‚             â”‚      â”œâ”€â†’ calculate_indicators()
       â”‚         â”‚             â”‚             â”‚      â”œâ”€â†’ predict_signal() [ML]
       â”‚         â”‚             â”‚             â”‚      â”œâ”€â†’ apply_filters()
       â”‚         â”‚             â”‚             â”‚      â””â”€â†’ execute_trades()
       â”‚         â”‚             â”‚             â”‚
       â”‚         â”‚             â”‚             â””â”€â†’ AdvancedBacktester
       â”‚         â”‚             â”‚                    â”œâ”€ Entry signals
       â”‚         â”‚             â”‚                    â”œâ”€ Exit signals
       â”‚         â”‚             â”‚                    â”œâ”€ Position sizing (Kelly)
       â”‚         â”‚             â”‚                    â”œâ”€ Risk management
       â”‚         â”‚             â”‚                    â””â”€ Calculate metrics
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ save_results()
       â”‚         â”‚             â”‚      â””â”€â†’ data/dashboard_results/*.json
       â”‚         â”‚             â”‚
       â”‚         â”‚             â””â”€â†’ launch_dashboard()
       â”‚         â”‚                    â””â”€â†’ http://localhost:8520
       â”‚         â”‚
       â”‚         â”œâ”€â†’ [--live-ccxt]
       â”‚         â”‚      â”‚
       â”‚         â”‚      â””â”€â†’ LiveTradingOrchestrator (CCXT)
       â”‚         â”‚             â”‚
       â”‚         â”‚             â”œâ”€â†’ Verify Security (DEMO/REAL)
       â”‚         â”‚             â”œâ”€â†’ Connect to Exchange (Binance)
       â”‚         â”‚             â”œâ”€â†’ Load Strategy
       â”‚         â”‚             â”œâ”€â†’ LOOP:
       â”‚         â”‚             â”‚      â”œâ”€ Fetch OHLCV
       â”‚         â”‚             â”‚      â”œâ”€ Generate Signal
       â”‚         â”‚             â”‚      â”œâ”€ Check Position
       â”‚         â”‚             â”‚      â”œâ”€ Execute Order
       â”‚         â”‚             â”‚      â”œâ”€ Monitor SL/TP
       â”‚         â”‚             â”‚      â””â”€ Wait next cycle
       â”‚         â”‚             â””â”€â†’ Emergency Stop
       â”‚         â”‚
       â”‚         â”œâ”€â†’ [--live-mt5]
       â”‚         â”‚      â”‚
       â”‚         â”‚      â””â”€â†’ LiveTradingOrchestrator (MT5)
       â”‚         â”‚             â””â”€â†’ (Similar flow to CCXT)
       â”‚         â”‚
       â”‚         â””â”€â†’ [--data-audit]
       â”‚                â”‚
       â”‚                â””â”€â†’ check_data_status()
       â”‚                       â”œâ”€â†’ Verify SQLite
       â”‚                       â”œâ”€â†’ Verify CSV
       â”‚                       â”œâ”€â†’ Identify missing
       â”‚                       â””â”€â†’ Download missing
       â”‚
       â””â”€â”€â”€[4]â”€â†’ RESULTS OUTPUT
                  â”‚
                  â”œâ”€â†’ Terminal Logs
                  â”œâ”€â†’ logs/bot_trader.log
                  â”œâ”€â†’ data/dashboard_results/*.json
                  â””â”€â†’ Dashboard UI (port 8520)
```

---

## FLUJO DE ML PREDICTION

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PREDICCIÃ“N ML EN ESTRATEGIA (predict_signal)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ENTRADA: data (DataFrame con OHLCV + indicadores)
      â”‚
      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. Cargar Modelo y Scaler                           â”‚
  â”‚                                                      â”‚
  â”‚    model_path = models/BNB_USDT/RandomForest.joblib â”‚
  â”‚    model = joblib.load(model_path)                  â”‚
  â”‚    scaler = joblib.load(scaler_path)                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 2. Preparar Features (IDÃ‰NTICOS al entrenamiento)   â”‚
  â”‚                                                      â”‚
  â”‚    features = prepare_features(data)                â”‚
  â”‚    â”‚                                                 â”‚
  â”‚    â”œâ”€â†’ RSI, EMA, MACD, ATR, ADX, Stochastic        â”‚
  â”‚    â”œâ”€â†’ Volume indicators                            â”‚
  â”‚    â”œâ”€â†’ Heikin Ashi features                         â”‚
  â”‚    â””â”€â†’ Price patterns                               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 3. Validar NÃºmero de Features (DINÃMICO)            â”‚
  â”‚                                                      â”‚
  â”‚    expected_features = len(features.columns)  âœ…    â”‚
  â”‚    # NO hardcodear: expected_features = 21 âŒ       â”‚
  â”‚                                                      â”‚
  â”‚    if features.shape[1] != expected_features:       â”‚
  â”‚        raise ValueError("Feature mismatch")         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 4. Validar Scaler Fitted                            â”‚
  â”‚                                                      â”‚
  â”‚    if not hasattr(scaler, 'mean_'):                 â”‚
  â”‚        logger.warning("Scaler not fitted")          â”‚
  â”‚        return pd.Series(0.5, index=data.index)      â”‚
  â”‚        # Retornar seÃ±ales neutrales como fallback   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 5. Normalizar Features                              â”‚
  â”‚                                                      â”‚
  â”‚    features_scaled = scaler.transform(features)     â”‚
  â”‚    # StandardScaler: (x - mean) / std               â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 6. Predecir Probabilidades                          â”‚
  â”‚                                                      â”‚
  â”‚    probas = model.predict_proba(features_scaled)    â”‚
  â”‚    â”‚                                                 â”‚
  â”‚    â”œâ”€â†’ probas[:, 0] = Probabilidad SHORT (-1)      â”‚
  â”‚    â”œâ”€â†’ probas[:, 1] = Probabilidad NEUTRAL (0)     â”‚
  â”‚    â””â”€â†’ probas[:, 2] = Probabilidad LONG (1)        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 7. Convertir a SeÃ±ales con Threshold                â”‚
  â”‚                                                      â”‚
  â”‚    signals = pd.Series(0, index=data.index)         â”‚
  â”‚    â”‚                                                 â”‚
  â”‚    if probas[:, 2] > ml_threshold:                  â”‚
  â”‚        signals = 1   # LONG                         â”‚
  â”‚    elif probas[:, 0] > ml_threshold:                â”‚
  â”‚        signals = -1  # SHORT                        â”‚
  â”‚    else:                                            â”‚
  â”‚        signals = 0   # NEUTRAL                      â”‚
  â”‚                                                      â”‚
  â”‚    # ml_threshold tÃ­picamente = 0.5                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 8. Aplicar Filtros Adicionales                      â”‚
  â”‚                                                      â”‚
  â”‚    â”œâ”€â†’ ADX > 25 (tendencia fuerte)                 â”‚
  â”‚    â”œâ”€â†’ Volume ratio > 1.4                           â”‚
  â”‚    â”œâ”€â†’ Stochastic overbought/oversold               â”‚
  â”‚    â””â”€â†’ ML confidence > threshold                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 9. Retornar SeÃ±ales Finales                         â”‚
  â”‚                                                      â”‚
  â”‚    return signals                                   â”‚
  â”‚    â”‚                                                 â”‚
  â”‚    â””â”€â†’ pd.Series con valores: -1, 0, 1             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
  SALIDA: signals â†’ Usadas por la estrategia para entry/exit
```

---

## VALIDACIÃ“N DE INTEGRIDAD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CHECKPOINTS DE VALIDACIÃ“N                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  [âœ…] Punto de Entrada Ãšnico
       â””â”€â†’ Solo main.py autorizado
       â””â”€â†’ NO usar archivos alternativos

  [âœ…] ConfiguraciÃ³n Centralizada
       â””â”€â†’ Solo config/config.yaml
       â””â”€â†’ Una sola estrategia activa

  [âœ…] Datos Reales Obligatorios
       â””â”€â†’ SQLite prioritario
       â””â”€â†’ CSV fallback
       â””â”€â†’ Descarga automÃ¡tica
       â””â”€â†’ NO sintÃ©ticos

  [âœ…] ML Sin Sesgos
       â””â”€â†’ TimeSeriesSplit âœ…
       â””â”€â†’ NO train_test_split âŒ
       â””â”€â†’ Features dinÃ¡micos
       â””â”€â†’ Labels sin NaN

  [âœ…] Modelos Centralizados
       â””â”€â†’ models/ Ãºnica ubicaciÃ³n
       â””â”€â†’ ModelManager gestiona
       â””â”€â†’ ValidaciÃ³n de scaler

  [âœ…] Estrategia Ãšnica
       â””â”€â†’ UltraDetailedHeikinAshiML
       â””â”€â†’ Indicadores centralizados
       â””â”€â†’ ML integrado

  [âœ…] Backtesting Preciso
       â””â”€â†’ Comisiones reales
       â””â”€â†’ Slippage considerado
       â””â”€â†’ MÃ©tricas completas

  [âœ…] Seguridad Live Trading
       â””â”€â†’ VerificaciÃ³n DEMO/REAL
       â””â”€â†’ Advertencias crÃ­ticas
       â””â”€â†’ Emergency stop
```

---

## RESUMEN EJECUTIVO

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESTADO DEL SISTEMA                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âœ… Arquitectura: Centralizada y Modular                     â”‚
â”‚  âœ… Punto de Entrada: Ãšnico (main.py)                        â”‚
â”‚  âœ… ConfiguraciÃ³n: Simplificada (config.yaml)                â”‚
â”‚  âœ… Datos: SQLite-First con fallback automÃ¡tico              â”‚
â”‚  âœ… ML: TimeSeriesSplit (sin look-ahead bias)                â”‚
â”‚  âœ… Estrategia: Una sola activa y optimizada                 â”‚
â”‚  âœ… Modelos: Centralizados en descarga_datos/models/         â”‚
â”‚  âœ… Backtesting: Completo y preciso                          â”‚
â”‚  âœ… OptimizaciÃ³n: Pipeline Optuna integrado                  â”‚
â”‚  âœ… Live Trading: Seguro con verificaciones                  â”‚
â”‚  âœ… Dashboard: Auto-lanzamiento en puerto 8520               â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    PRÃ“XIMO PASO                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸš€ ENTRENAR MODELO ML:                                      â”‚
â”‚     cd descarga_datos                                        â”‚
â”‚     python main.py --train-ml                                â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š EJECUTAR BACKTEST:                                       â”‚
â”‚     python main.py --backtest-only                           â”‚
â”‚                                                              â”‚
â”‚  ğŸ”¬ OPTIMIZAR (opcional):                                    â”‚
â”‚     python main.py --optimize                                â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Diagrama generado**: 9 de octubre de 2025  
**VersiÃ³n**: 3.0 - Clean & Optimized  
**Estado**: âœ… Sistema Validado y Listo para Uso
